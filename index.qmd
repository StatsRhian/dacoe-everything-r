---
title: "Everything you wanted to know about R & Quarto"
subtitle: "But were too afraid to ask"
author: "[Rhian Davies](mailto:rhian.davies25@nhs.net)"
date: 2024-10-17
date-format: "MMM D, YYYY"
engine: knitr
format: su-theme-revealjs
filters:
  - webr
  - collapse-social-embeds
footer: "[statsrhian.github.io/dacoe-everything-r](https://statsrhian.github.io/dacoe-everything-r)"
---

## Hi I'm Rhian üëã

:::: {.columns}

::: {.column width='20%'}

![A profile photo of Rhian.](img/rd.jpg)\
:::

::: {.column width='20%'}

![Logo for The Strategy Unit](img/logo.png)\

:::

::: {.column width='60%'}

- Senior Data Scientist at the Strategy Unit
- Expert in R training & consultancy
- Statistics PhD
- Statistical Ambassador for the RSS

:::

::::


::: {.notes}
* Evaluation and impact assessment

* Complex modelling

* Evidence reviews

* Learning & Development

* HACA and NHSR conference
:::


# What & Why R? {.inverse}

## What questions do _you_ have? ü§î

- [Ask a question](https://www.menti.com/al6cq199iq8n)
- [View all questions](https://www.mentimeter.com/app/presentation/n/alp7qmy9cxh6exv78fcdw5f2fa2m6jux/present?question=pktjb8muvskg)


## What is R?

:::: {.columns}
::: {.column width='60%'}

- A programming language
- About [30 years old](https://www.jumpingrivers.com/misc/timeline/)
- Originally specialised in statistics but now very broad
- Cross-platform
- Used by many organisations

:::
::: {.column width='40%'}

![The logo for R programming, a large blue letter R](img/Rlogo.svg)\

:::
::::


:::{.notes}
Silly R stuff too?
:::


## Why use R?

:::{.incremental}
- Free & open-source
- Diverse ecosystem of packages
- Write your own functions
- Excellent support for statistical modelling
- Professional graphics
- Students learn R
- Friendly community üíú
:::

::: {.notes}
Many of the statistical models were written by the statisticans who developed the methods 
:::

## Reproducible Analytical Pipelines ‚≠ê

> It will be built using open source software for data management, analysis and visualisation (such as R or python) as this is standard, portable, and available to all for checking and re-use. 

--- [Goldacre Review 2022](https://www.gov.uk/government/publications/better-broader-safer-using-health-data-for-research-and-analysis/better-broader-safer-using-health-data-for-research-and-analysis#executive-summary:~:text=It%20will%20be%20built%20using%20open%20source%20software%20for%20data%20management%2C%20analysis%20and%20visualisation%20(such%20as%20R%20or%20python)%20as%20this%20is%20standard%2C%20portable%2C%20and%20available%20to%20all%20for%20checking%20and%20re%2Duse.)

## Packages üì¶

- Over 21,000 on CRAN
- Many more on GitHub
- [Diverse topics](https://cran.r-project.org/web/views/)

## {.inverse}

![](img/cvdprevent.PNG)


## Can it work with my data?

::: {.incremental}
 - Yes!
:::

:::{.notes}

SQL
databricks
databases
SPSS
SAS
CSV / Excel
Cloud  e.g. Azure
API
:::

## How do I get started? üöÄ

1. [Install R](https://cran.rstudio.com/)

1. [Install RStudio](https://posit.co/download/rstudio-desktop/)

You can also [try it out in Posit Cloud](https://posit.cloud/plans/free)


::: {.aside}
If you're already a coder, there's a new IDE called [Positron](https://github.com/posit-dev/positron) based on VS-Code which you might prefer.

:::

::: {.notes}
Demo R in terminal vs RStudio
You don't need to install R for today's session
But I do have some snippets of code you can play with
:::

# Let's go! üöÄ

## Length of Stay data

```{r, setup R}
#| echo: false
library("dplyr")

los_data <- read.csv('https://raw.githubusercontent.com/StatsRhian/dacoe-everything-r/refs/heads/main/LOS_data.csv')
reactable::reactable(los_data)
```

:::{.notes}
Fictional data, adapted from {NHSRdatasets}
We might want to ask questions such as
- Which area has the most patients?
- What is the longest length of stay in the data?
- Is there a correlation between age and length of stay?
:::

## Load in data

```{webr-r}
#| warning: false
# Load library to manipulate
library(dplyr)

# Download simple dataset
los_data <- read.csv('https://raw.githubusercontent.com/StatsRhian/dacoe-everything-r/refs/heads/main/LOS_data.csv')
head(los_data)
```

## Watch me üëÄ

```{webr-r}
# How many rows?
nrow(los_data)

# How old is the oldest person in the dataset?
max(los_data$Age)

# Whats the mean length of stay?
mean(los_data$LOS)
```

## Your turn üíª

Change the code below and click _Run_

```{webr-r}
# How many columns?
nrow(los_data)

# How old is the oldest person in the dataset?
max(los_data$Age)

# Whats the median length of stay?
mean(los_data$LOS)

```

::: {.callout-important}
Capitalisation matters!
:::

## Watch me üëÄ

- Keep just the Midsomer data
```{webr-r}
los_data |>
  filter(Area == "Midsomer")
```

::: {.callout-note}
Notice double `==`
::: 

## Your turn üíª

- Change to keep `Sex` is `Female`

```{webr-r}
#| warning: false
los_data |>
  filter(Area == "Midsomer")
```

## Watch me üëÄ

- What is the mean length of stay for each sex?
```{webr-r}
los_data |>
  group_by(Sex) |>
  summarise(mean_los = mean(LOS))
```

## Your turn üíª
- Calculate the `median()` `LOS` for each `Area`

```{webr-r}
#| warning: false
los_data |>
  group_by(Sex) |>
  summarise(mean_los = mean(LOS))
```

::: {.callout-note}
Feel free to try grouping by other variables, or using other summarisation functions e.g. `mean()`, `min()`, `max()`, `sd()`
::: 

# Making pretty graphics

## Professional quality graphics

![Six different graphics made by the BBC graphics team. There is a variety of different graph types, including histograms, area plots, maps and dot-plots. All are styled in the BBC branding.](img/bbc.png)\


## Professional quality graphics

<center>
<blockquote class="twitter-tweet"><p lang="en" dir="ltr">NEW on coronavirus: many western countries may soon face Italy‚Äôs situation<br><br>Case numbers since outbreaks began in several countries have tracked a ~33% daily rise. This is as true for UK, France, Germany as Italy; the latter is simply further down the path <a href="https://t.co/VcSZISFxzF">https://t.co/VcSZISFxzF</a> <a href="https://t.co/xM6wXuMk4n">pic.twitter.com/xM6wXuMk4n</a></p>&mdash; John Burn-Murdoch (@jburnmurdoch) <a href="https://twitter.com/jburnmurdoch/status/1237737352879112194?ref_src=twsrc%5Etfw">March 11, 2020</a></blockquote> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script></center>


::: {.twitter user=jburnmurdoch status_id=1237737352879112194}
:::

## Watch me üëÄ

```{webr-r}
#| message: false
#| fig-height: 2
library(ggplot2)
los_data |>
  ggplot(aes(x = Age, y = LOS)) + 
  geom_point()
```

## Your turn üíª

:::: {.columns}

::: {.column width='70%'}

```{webr-r}
#| message: false
#| fig-height: 2
library(ggplot2)
los_data |>
  ggplot(aes(x = Age, y = LOS)) + 
  geom_point(col = "red")
```

:::

::: {.column width='30%'}

1. Change the the colour of the points to `"blue"`
1. Add the line `geom_smooth(method = "lm")`. You'll need a `+` at the end of line 4.

:::

::::


## We can make maps too


```{r}
library("sf")
library("leaflet")

uk <- sf::read_sf("ukgeom")

pal = colorNumeric(palette = c("yellow", "orange", "red"), 
                   domain = uk$pop_2017)

uk |>
  dplyr::mutate(info = glue::glue("<b>{region}</b>  <br>
                  Population: {pop_2017}")) |>
  dplyr::mutate(info = purrr::map(info, htmltools::HTML)) |>
  leaflet::leaflet() |> 
  leaflet::addTiles() |>
  leaflet::addPolygons(fillColor = ~pal(pop_2017), fillOpacity = 0.7,
                       color = "black", weight = 1, 
                       label = ~info)
```

::: {.notes}
No need for expensive GIS software
:::


## Shiny apps 

- Interactive web applications
- No need to learn Javascript or HTML
- [Gallery](https://shiny.rstudio.com/gallery/)
- [Mental Health Surge Modelling](https://strategyunit.shinyapps.io/MH_Surge_Modelling/)

:::{.notes}


:::

# Hello quarto üëã

## What is [quarto?](https://quarto.org/)

![](img/quarto.jpg){fig-alt="The quarto logo: A circle cut into four quadrants next to the word quarto"}

> An **open-source** scientific and technical **publishing** system

## 

![Artwork from "Hello, Quarto" keynote by Julia Lowndes and Mine √áetinkaya-Rundel, presented at RStudio Conference 2022. Illustrated by Allison Horst.](img/quarto-flow.png){fig-alt="A schematic representing the multi-language input (e.g. Python, R, Observable, Julia) and multi-format output (e.g. PDF, html, Word documents, and more) versatility of Quarto."}

:::{.notes}
These slides were made in Quarto!
:::

## Automating reports üìã

::: {.incremental}
- The data was wrong - can you re-run the analysis?
- Your manager loves it - can you do it for another region?
- Next month - do it all again.
- There must be a better way

:::

## Example report

![](img/ne-april.png)

[statsrhian.github.io/example-quarto-report/example-report.html](https://statsrhian.github.io/example-quarto-report/example-report.html)

## Template based-reports

```{r}
#| echo: true
#| eval: false
#| code-line-numbers: "1-8|6-8|2-3"
---
title: "NHS Workforce Statistics for `r params$ics_name`"
subtitle: "Data for `r params$month_year`"
author: "Maria Garcia"
date: "2023-09-28"
params:
  ics_name: "North East and North Cumbria"
  month_year: "April 2023"
---
```

## Interweave text and code üß∂

. . .

__Read in the data__

```{r}
#| echo: true
#| eval: false
filename = glue("NHS Workforce Statistics, {params$month_year} England and Organisation.xlsx")
```

. . .

 __Clean the data__

```{r}
#| echo: true
#| code-line-numbers: "3"
#| eval: false 
staff_group = 
  staff_group |>
  filter(`ICS name` == params$ics_name) |>
  select(`Organisation name`, `Total`,
         `HCHS Doctors`, `Nurses & health visitors`,
         `Midwives`, `Ambulance staff`) 
```

. . . 

__Add insight__
```{r}
#| echo: true
#| eval: false
The table below shows the total number of doctors and nurses for each organisation within `r params$ics_name`. We can see that the organisation with the most midwives is the `r pull(max_midwives, "Organisation name")` with `r round(max_midwives$Midwives)` staff.
```

## Re-run next month

```{r}
#| echo: true
#| eval: false
#| code-line-numbers: "8"
---
title: "NHS Workforce Statistics for `r params$ics_name`"
subtitle: "Data for `r params$month_year`"
author: "Maria Garcia"
date: "2023-09-28"
params:
  ics_name: "North East and North Cumbria"
  month_year: "May 2023"
```

##  {background-image="img/ne-may.png"}

## Report a different region

```{r}
#| echo: true
#| eval: false
#| code-line-numbers: "7"
---
title: "NHS Workforce Statistics for `r params$ics_name`"
subtitle: "Data for `r params$month_year`"
author: "Maria Garcia"
date: "2023-09-28"
params:
  ics_name: "Lancashire and South Cumbria"
  month_year: "May 2023"
```

##  {background-image="img/nw-may.png"}

# Using R in your organisation

## Enterprise tools üè¢

:::: {.columns}
::: {.column width='60%'}

- Posit Workbench
- Posit Package Manager
- Posit Connect

[Working with Posit](https://posit.co/champions/working-with-it/)

[Posit Partners](https://posit.co/our-partners/)

:::
::: {.column width='40%'}

![The logo for Posit](img/posit.png)\

:::
::::

## Is R safe? ‚úÖ

:::: {.columns}
::: {.column width='60%'}

- All code is open
- Packages are often well tested
- [R Validation Hub](https://www.pharmar.org/)
[Posit Partners](https://posit.co/our-partners/)

:::
::: {.column width='40%'}

![The logo for testthat](img/testthat.png)\

:::
::::


## Want to learn more? üìö

:::: {.columns}
::: {.column width='60%'}


- [R4DS book](https://r4ds.hadley.nz/)
- [TidyTuesday](https://github.com/rfordatascience/tidytuesday)
- The [NHS-R community](https://nhsrcommunity.com/)

:::
::: {.column width='40%'}

![The logo for Tidy Tuesday](img/tidytuesday.jpg)\

:::
::::
